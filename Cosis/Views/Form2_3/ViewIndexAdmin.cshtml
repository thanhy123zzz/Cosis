@model Cosis.Models.PhieuDieuTra
@{
    FormCosisContext context = new FormCosisContext();
    int getThang()
    {
        return DateTime.Now.Month;
    }
    string getThangTruoc(string m)
    {
        int i = Int32.Parse(m);
        if (i == 1)
        {
            return "12";
        }
        else
        {
            return toStringMonth(i - 1);
        }
    }
    int getNam()
    {
        return DateTime.Now.Year;
    }
    string getThangNamTruoc()
    {
        if (getThang() == 1)
            return "12/" + (getNam() - 1);
        else
        {
            return (getThang() - 1) + "/" + getNam();
        }
    }
    List<Master> getMasters()
    {
        return context.Master.ToList();
    }

    string getArray()
    {
            return "";
        

    }

    string toStringMonth(int i)
    {
        if (i.ToString().Length > 1) return i.ToString();
        else return "0" + i;
    }

    string toStringMonthAndYear(int m, int year)
    {
        if (m == 1)
        {
            return 12 + "/" + (year - 1).ToString();
        }
        else
        {
            return toStringMonth(m - 1) + "/" + year;
        }
    }
    List<ThongTinCaThe> getTable()
    {
        return context.ThongTinCaThe.Where(x => x.MaLoaiPhieu == "Form2_3").ToList();
    }
    NganhHoatDongKinhDoanh getNganhHoatDongKinhDoanh(string ma)
    {
        return context.NganhHoatDongKinhDoanh.Where(x => x.MaNganh == ma).FirstOrDefault();
    }
    List<NganhKinhDoanh> getNganhKinhDoanh(string mcs)
    {
        return context.NganhKinhDoanh.Where(x => x.MaCoSo == mcs).ToList();
    }
    int count(string mcs, string thang, string nam)
    {
        return context.Master.Where(x => x.MaCoSo == mcs && x.ThangDuTinh == thang && x.Nam == nam).Count();
    }
    List<NganhKinhDoanh> list;
}
      <form id="form" action="/form2_3" method="post" enctype="multipart/form-data">
           <div class="choose-day row">
          <div class="choose-month">
            <label for="">Tháng</label>
            <select name="thangDuTinh" id="phieuThang" onchange="doiPhieu()">
                @for (int i = 1; i <= 12; i++)
                {
                    @if (Int32.Parse(ViewBag.thang) == i)
                    {
                                        <option selected value="@toStringMonth(i)">@toStringMonth(i)</option>
                    }
                    else
                    {
                                        <option value="@toStringMonth(i)">@toStringMonth(i)</option>
                    }
                }
            </select>
            <input type="hidden" name="thangThucHien" value="@getThangTruoc(ViewBag.thang)"/>
          </div>
          <div class="choose-year">
            <label for="">Năm</label>
            <input id="phieuNam"
              type="text"
              size="1"
              name="nam"
              value="@ViewBag.nam"
              style="height: 26px"

            />
          </div>
        </div>
        <div class="form-group text-center">
        
          <label> <b>ĐIỀU TRA HOẠT ĐỘNG THƯƠNG MẠI VÀ DỊCH VỤ </b> </label>
        </div>
        <div class="form-group row">
          <label class="P-name"><b>Phiếu 2.3/CT-VT-T</b></label>
          <input type="hidden" id="tenPhieu" value="2.3"/>
        </div>
           <div class="form-group text-center tenphieu">
          <label class="text-center">
            <b>PHIẾU THU THẬP THÔNG TIN ĐỐI VỚI CƠ SỞ KINH DOANH CÁ THỂ</b>
          </label>
          <label>
            <b>
              <i>
                (Áp dụng đối với cơ sở kinh doanh cá thể có hoạt động vận tải,
                kho bãi)
              </i>
            </b>
          </label>
        </div>

        <div class="form-group text-center">
          <div class="row"></div>
          <div>
            <label> <b>Tháng @ViewBag.thang Năm @ViewBag.nam</b> </label>
          </div>
          <div class="row"></div>
        </div>
          <div class="form-group m-title text-center">
          <h5><b>A. THÔNG TIN CHUNG</b></h5>
        </div>
        <div id="ThongTinDoanhNghiepGroup" class="form-group">
          <div class="row">
            <label class="lb-info">Tỉnh/TP trực thuộc TW: </label>
            <select name="Master.MaTinhTp" id="city" class="infoma">
              <option value="">--- Chọn Tỉnh/TP ---</option>
            </select>
          </div>
          <div class="row">
            <label class="lb-info"
              >Huyện/quận <i>(thị xã, TP thuộc tỉnh)</i>:
            </label>
            <select name="Master.MaQuanHuyen" id="district" class="infoma">
              <option value="">--- Chọn Huyện/quận ---</option>
            </select>
          </div>
          <div class="row">
            <label class="lb-info">Xã/phường/thị trấn: </label>
            <select name="Master.MaPhuongXa" id="ward" class="infoma">
              <option value="">--- Chọn Xã/phường/thị trấn ---</option>
            </select>
          </div>
          <div class="row">
            <label class="lb-info">Địa bàn: </label>
            <input type="text" name="Master.TenCoSo"  class="infoma" />
          </div>
          <div class="row">
            <label class="lb-info">Mã cơ sở: </label>
            <input type="text" id="macoso" maxlength="5" class="infoma" required autofocus/>
          </div>
          <div class="row">
            <label class="lb-info">Tên cơ sở: </label>
            <input type="text" name="" class="infoma" />
          </div>
          <div class="row">
            <label class="lb-info">Mã số thuế</label>
            <input
              type="text"
              id="n0"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off" autofocus
              data-next="1"
            />
            <input
              type="text"
              id="n1"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="2"
            />
            <input
              type="text"
              id="n2"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="3"
            />
            <input
              type="text"
              id="n3"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="4"
            />
            <input
              type="text"
              id="n4"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="5"
            />
            <input
              type="text"
              id="n5"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="6"
            />
            <input
              type="text"
              id="n6"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="7"
            />
            <input
              type="text"
              id="n7"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="8"
            />
            <input
              type="text"
              id="n8"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="9"
            />
            <input
              type="text"
              id="n9"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="10"
            />

            <input
              type="text"
              id="n10"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="11"
            />
            <input
              type="text"
              id="n11"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="12"
            />
            <input
              type="text"
              id="n12"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="13"
            />
          </div>
          <div class="row">
            <label class="lb-info">Thôn, ấp<i>(số nhà, đường phố)</i>: </label>
            <input type="text" name="Master.DiaChiCuThe" class="infoma" />
          </div>

          <div class="row">
            <label class="lb-info">Số điện thoại: </label>
            <input name="Master.Sdt" type="text" class="infoma" />
          </div>
          <div class="row">
            <label class="lb-info">Email: </label>
            <input name="Master.Email" type="text" class="infoma" />
          </div>
          <div class="loaihinh">
            <label>Loại hình kinh tế</label>

            <div class="checkbox-tt">
              <label> 1.Kinh tế nhà nước</label>
              <label> 2.Kinh tế ngoài nhà nước</label>
              <label> 3.Kinh tế có vốn đầu tư trực tiếp nước ngoài</label>
            </div>
            <div class="checkbox">
              <input type="radio" name="Master.MaLh" value="Kinh tế nhà nước" />
              <input
                type="radio"
                name="Master.MaLh"
                value="Kinh tế ngoài nhà nước"
              />
              <input
                type="radio"
                name="Master.MaLh"
                value="Kinh tế có vốn đầu tư trực tiếp nước ngoài"
              />
            </div>
          </div>
          <div class="nganhKD">
            <div class="row">
              <label for="">Ngành hoạt động kinh doanh</label>
              <div class="MNHD row">
                <input
                  type="text"
                  maxlength="1"
                  size="1"
                  class="text-center MN"
                />
                <input
                  type="text"
                  maxlength="1"
                  size="1"
                  class="text-center MN"
                />
                <input
                  type="text"
                  maxlength="1"
                  size="1"
                  class="text-center MN"
                />
                <input
                  type="text"
                  maxlength="1"
                  size="1"
                  class="text-center MN"
                />
                <input
                  type="text"
                  maxlength="1"
                  size="1"
                  class="text-center MN"
                />
              </div>
              <label for="">Tên ngành HĐKD:</label>
              <input type="text" class="infoma-nganh" />
            </div>
          </div>
        </div>
           <div class="form-group m-title text-center">
          <h5><b>B. KẾT QUẢ HOẠT ĐỘNG KINH DOANH</b></h5>
        </div>
   <table class="table table-striped table-hover table-bordered" id="tab-KQ">
          <thead>
            <tr class="text-center">
              <th>Chi tiết</th>
              <th>Đơn vị tính</th>
              <th>Thực hiện tháng @getThangNamTruoc()</th>
              <th>Dự tính @getThang()/@getNam() </th>
              <th>CỘNG DỒN TỪ ĐẦU NĂM ĐẾN CUỐI THÁNG BÁO CÁO</th>
            </tr>
          </thead>
          <tbody id="table-data">
            <tr class="text-center">
              <td>A</td>
              <td>B</td>
              <td>1</td>
              <td>2</td>
              <td>3</td>
            </tr>
            <tr>
              <td>
                1. Ông/bà vui lòng cho biết tổng số tiền thu về (bao gồm cả vốn
                và lãi) của cơ sở trong [tháng trước] và [tháng báo cáo] là bao
                nhiêu?
              </td>
              <td class="text-center">Triệu đồng</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
            </tr>

            <tr>
              <td>
                2. Trong tổng số tiền thu về của cơ sở, số tiền thu về do cung
                cấp dịch vụ [NGÀNH CHỌN MẪU] của [tháng trước] và [tháng báo
                cáo] là bao nhiêu?
              </td>
              <td class="text-center">Triệu đồng</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
            </tr>
            <tr class="text-left">
              <td colspan="5">I. HOẠT ĐỘNG VẬN TẢI HÀNH KHÁCH</td>
            </tr>
            <tr>
              <td>
                3. Cơ sở có bao nhiêu phương tiện đang sử dụng để phục vụ cho
                hoạt động vận tải hành khách trong [tháng trước] và dự tính
                [tháng báo cáo]?
              </td>
              <td class="text-center">Cái</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                4. Tổng số ghế của tất cả các phương tiện trên là bao nhiêu?
              </td>
              <td class="text-center">Ghế</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
            </tr>
            <tr class="text-left">
              <td>5. Cơ sở có vận chuyển hành khách ngoài nước không?</td>
              <td></td>
              <td class="text-center">
                1. Có <input type="radio" name="chose1" id="5" />
              </td>
              <td class="text-center">
                2. Không <input type="radio" name="chose1" id="5-1" />
              </td>
            </tr>
            <tr class="text-left">
              <td>
                6. Số chyến vận chuyển khách trong [tháng trước] và [tháng báo
                cáo] của cơ sở là bao nhiêu?
              </td>
              <td class="text-center">Chuyến</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left changed1">
              <td>
                6.1 Trong đó, số chuyến vận chuyển ngoài nước là bao nhiêu?
                (Hiển thị nếu có câu 5 = 1 "CÓ")
              </td>
              <td class="text-center">Chuyến</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                7. Số khách bình quân/chuyến trong [tháng trước] và [tháng báo
                cáo] là bao nhiêu?
              </td>
              <td class="text-center">Hành khách</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                7.1 Trong đó, số khách bình quân 1 chuyến vận chuyển ngoài nước
                là bao nhiêu?
              </td>
              <td class="text-center">Hành khách</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                8. Số km bình quân 1 chuyến mà các phương tiện có vận chuyển
                khách trong [tháng trước] và [tháng báo cáo] là bao nhiêu?
              </td>
              <td class="text-center">Km</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                8.1 Trong đó, số km bình quân 1 chuyến vận chuyển ngoài nước là
                bao nhiêu?
              </td>
              <td class="text-center">Km</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>9. SỐ LƯỢT HÀNH KHÁCH VẬN CHUYỂN</td>
              <td class="text-center">Hành khách</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="changed1">
              <td>9.1 TRONG ĐÓ, SỐ LƯỢT HÀNH KHÁCH VẬN CHUYỂN NGOÀI NƯỚC</td>
              <td class="text-center">Hành khách</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>10. SỐ LƯỢT HÀNH KHÁCH LUÂN CHUYỂN</td>
              <td class="text-center">Hành khách.Km</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left changed1">
              <td>
                10.1 TRONG ĐÓ, SỐ LƯỢT HÀNH KHÁCH VẬN LUÂN CHUYỂN NGOÀI NƯỚC
                (Hiển thị nếu câu 5=1 "CÓ")
              </td>
              <td class="text-center">Hành khách.Km</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td colspan="5">II. HOẠT ĐỘNG VẬN TẢI HÀNG HÓA</td>
            </tr>
            <tr class="text-left">
              <td>
                11. Cơ sở có bao nhiêu phương tiện đang sử dụng để phục vụ cho
                hoạt dộng vận tải hàng hóa trong [tháng trước] và dự tính [tháng
                báo cáo]?
              </td>
              <td class="text-center">Cái</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                12. Tổng trọng tải của tất cả các phương tiện trên là bao nhiêu?
              </td>
              <td class="text-center">Tấn</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>13. Cơ sở có vận chuyển hàng hóa ngoài nước không?</td>
              <td></td>
              <td class="text-center">
                1. Có <input type="radio" name="chose2" id="13" />
              </td>
              <td class="text-center">
                2. Không <input type="radio" name="chose2" id="13-1" />
              </td>
            </tr>
            <tr class="text-left">
              <td>
                14. Số vận chuyển hàng hóa trong [tháng trước] và [tháng báo
                cáo] của cơ sở là bao nhiêu?
              </td>
              <td class="text-center">Chuyến</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left changed2">
              <td>
                14.1 Trong đó, số chuyến vận chuyển ngoài nước là bao nhiêu?
                (Hiển thị nếu câu 13=1 "CÓ")
              </td>
              <td class="text-center">Chuyến</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                15. Khối lượng hàng hóa bình quân/chuyến trong [tháng trước] và
                [tháng báo cáo] là bao nhiêu?
              </td>
              <td class="text-center">Tấn</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                15.1 Trong đó, Khối lượng hàng hóa bình quân 1 chuyến vận chuyển
                ngoài nước là bao nhiêu?
              </td>
              <td class="text-center">Tấn</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                16. Số km bình quân 1 chuyến mà các phương tiện có vận chuyển
                hàng hóa trong [tháng trước] và [tháng báo cáo] là bao nhiêu?
              </td>
              <td class="text-center">Km</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>
                16.1 Trong đó, số km bình quân 1 chuyến vận chuyển ngoài nước là
                bao nhiêu?
              </td>
              <td class="text-center">Km</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>17. KHỐI LƯỢNG HÀNG HÓA VẬN CHUYỂN</td>
              <td class="text-center">Tấn</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left changed2">
              <td>
                17.1 TRONG ĐÓ, KHỐI LƯỢNG HÀNG HÓA VẬN CHUYỂN NGOÀI NƯỚC (Hiển
                thị nếu câu 13=1 "CÓ")
              </td>
              <td class="text-center">Tấn</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left">
              <td>18. KHỐI LƯỢNG HÀNG HÓA LUÂN CHUYỂN</td>
              <td class="text-center">Tấn.Km</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
            <tr class="text-left changed2">
              <td>
                18.1 TRONG ĐÓ, KHỐI LƯỢNG LUÂN CHUYỂN NGOÀI NƯỚC (Hiển thị nếu
                câu 13=1 "CÓ")
              </td>
              <td class="text-center">Tấn.Km</td>
              <td><input type="text" class="infoma" /></td>
              <td><input type="text" class="infoma" /></td>
              <td></td>
            </tr>
          </tbody>
        </table>
        <div class="form-group m-title text-center">
          <h5 style="margin-top: .5rem;"><b>C. CÁC YẾU TỔ ẢNH HƯỞNG ĐẾN HOẠT ĐỘNG KINH DOANH</b></h5>
        </div>
        <div class="form-group">
          <label for=""
            >Yếu tố nào sau đây ảnh hưởng đến hoạt động kinh doanh của đơn vị
            trong tháng ...</label
          >
          <div class="YTAH">
            <div class="YTAH-tt">
              <label for="">1. Nhu cầu thị trường</label>
              <label for="">2. Dịch bệnh</label>
              <label for="">3. Thời tiết</label>
              <label for="">4. Ảnh hưởng mùa vụ</label>
              <label for="">5. Thay đổi nhân sự</label>
              <label for="">6. Thay đổi kĩ thuật/công nghệ/phương tiện</label>
              <label for="">7. Nguồn vốn kinh doanh</label>
              <label for="">8. Thay đổi địa điểm/thị trường kinh doanh</label>
              <label for="">9. Lý do khác: ghi rõ</label>
            </div>
            <div class="YTAH-check">
                    <input type="checkbox" id="DanhSachNhanToAnhHuong_0" name="DanhSachNhanToAnhHuong_0" value="01" />
                    <input type="checkbox" id="DanhSachNhanToAnhHuong_1" name="DanhSachNhanToAnhHuong_1" value="02" />
                    <input type="checkbox" id="DanhSachNhanToAnhHuong_2" name="DanhSachNhanToAnhHuong_2" value="03" />
                    <input type="checkbox" id="DanhSachNhanToAnhHuong_3" name="DanhSachNhanToAnhHuong_3" value="04" />
                    <input type="checkbox" id="DanhSachNhanToAnhHuong_4" name="DanhSachNhanToAnhHuong_4" value="05" />
                    <input type="checkbox" id="DanhSachNhanToAnhHuong_5" name="DanhSachNhanToAnhHuong_5" value="06"/>
                    <input type="checkbox" id="DanhSachNhanToAnhHuong_6" name="DanhSachNhanToAnhHuong_6" value="07" />
                    <input type="checkbox" id="DanhSachNhanToAnhHuong_7" name="DanhSachNhanToAnhHuong_7" value="08" />
               
                      <input type="checkbox" id="YT9" value="" />
               
                           <input type="checkbox" checked id="YT9" value="" />
                
            </div>
          </div>
          <div class="YTAH9">
            <textarea
              class="form-control"
              rows="1"
              id="comment"
              name="NhanToThu9.NoiDung"
              disabled
            ></textarea>
          </div>
        </div>
        <div class="form-group uname-info">
          <div class="row">
            <label class="uname-lb">Họ tên người trả lời:</label>
            <input type="text" name="Master.TenNguoiTraLoi" id="" class="infoma" />
          </div>
          <div class="row">
            <label class="uname-lb">Số điện thoại:</label>
            <input type="text" name="Master.SdtnguoiTraLoi" id="" class="infoma" />
          </div>
        </div>
        <div class="group-btn" style="justify-content: end;">
          <select name="loai" style="margin-right:10px">
              <option value="0">Chọn file cần xuất</option>
              <option value="1">Xuất File PDF</option>
              <option value="2">Xuất File Excel</option>
              <option value="3">Xuất cả 2</option>
          </select>
          <button type="submit" value="false" class="btn btn-primary">Lưu</button>
        </div>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
      <script type="text/javascript">
        var pattern = /^\d{5}$/;
    $('input#macoso').keyup(function() {
        if ($('input#macoso').val().match(pattern)) {        
          $('input#macoso').focusout(function(){
          });
          var str = $('input#macoso').val();
          $.ajax({
            type: 'POST',
            url: '/loadMaster2CN',
            data: "ms=" + $('input#macoso').val(),
            success: function (result) {
              $('#ThongTinDoanhNghiepGroup').replaceWith(result);
              if ($('label.P-name b').text().includes('2.3')) {
                  $.ajax({
                    type: 'POST',
                    url: '/loaddata_2_3',
                    data: "ms=" +str,
                    success: function (result) {
                      $('#table-data').replaceWith(result);
                    },
                    error: function (result) {
                      console.log('Mã cơ sở không tồn tại!');
                    }
                  });
                }
            },
            error: function (result) {
              alert('Mã cơ sở không tồn tại!');
            }
          });
        } else {
        }
    });
     $(document).ready(function(){
          let ms = $('#Maphieu').val();
          let mst = $('#macoso').val();
          if(ms!=undefined){
                $.ajax({
                    type: 'POST',
                    url: '/loadMaster2CN',
                    data: "ms=" + mst,
                    success: function (result) {
                        $('#ThongTinDoanhNghiepGroup').replaceWith(result);


              },
                    error: function (result) {
                        alert('Mã cơ sở không tồn tại!');
             }
            });
           }
            var a = [@Html.Raw(getArray())];
            a.forEach(myFunction);
            $('.infomal').each(format);
    })
    function doiPhieu(mcs){
        var thang = $('#phieuThang').val();
        var nam = $('#phieuNam').val();
        var s = "@Html.Raw(ViewBag.LoaiPhieu)";

        $.ajax({
                    type: 'POST',
                    url: '/changePhieu2_3',
                    data: "thang=" + thang + "&nam="+nam + "&mcs="+mcs,
                    success: function (result) {
                        $('#form').replaceWith(result);
                            let kq = "@User.IsInRole("001")"
                            if(kq=="True"){
                                $('#bodyDiv').addClass("col-lg-12");
                                $('#form').addClass("form");
                                $('#tableQLTT').css("display","block");
                                $('.MS').prop('readonly', false);
                            }else{
                                $('#tableQLTT').css("display","none");
                                $('#form').addClass("form1");
                                $('.MS').prop('readonly', true);
                            }
                    },
                    error: function (result) {
                        alert('Mã số thuế không tồn tại!');
             }
          });
    }

    $('.infomal').on('blur', format);
function format(){
    if(checkNumber(this.value)){
        const value = this.value.replace(/,/g, '');
        this.value = parseFloat(value).toLocaleString('en-US', {
        style: 'decimal',
            maximumFractionDigits: 2,
            minimumFractionDigits: 2
            })
    }
}

     function changeThthangTruoc(tt){

        var value = getValue($('#ThthangTruoc'+tt).val());

        if(checkNumber(value)){
            var stt = $('#stt'+tt).val();        
            var mst = $('#macoso').val();
            var duTinh = $('#DuTinh'+tt).val();
            var thangDuTinh = $('#phieuThang').val();
            var nam = $('#phieuNam').val();
            $.ajax({
                type: 'POST',
                url: '/get-tong2_3',
                data: "mast=" + mst + "&stt="+stt+"&thangTrc="+value+"&duTinh="+duTinh+"&thangDuTinh="+thangDuTinh+"&nam="+nam,
                success: function (result) {
                    $('#TongCongDon'+tt).val(
                        parseFloat(result).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
                    );
                    changeCongDon(result,tt);
                },
               error: function (result) {
               alert('Mã số thuế không tồn tại!');
             }
            });
         }
         }

         function dutinh9(){
             let dt6_1 = document.getElementById('ThthangTruoc6_1').value;
             let dt7_1 = document.getElementById('ThthangTruoc7_1').value;

             let dt9 = dt6_1 * dt7_1;
             document.getElementById('ThthangTruoc9').value= dt9;
             $("#ThthangTruoc9").val(
                parseFloat(dt9).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );

         }



    function changeDuTinh(tt){


        var value = parseFloat($('#DuTinh'+tt).val());

        if(checkNumber(value)){
            var stt = $('#stt'+tt).val();        
            var mst = $('#macoso').val();
            var duTinh = $('#ThthangTruoc'+tt).val();
            var thangDuTinh = $('#phieuThang').val();
            var nam = $('#phieuNam').val();
            $.ajax({
                type: 'POST',
                url: '/get-tong2_3',
                data: "mast=" + mst + "&stt="+stt+"&thangTrc="+value+"&duTinh="+duTinh+"&thangDuTinh="+thangDuTinh+"&nam="+nam,
                success: function (result) {
                    $('#TongCongDon'+tt).val(
                        parseFloat(result).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
                    );
                    changeCongDon(result,tt);
                },
               error: function (result) {
               alert('Mã số thuế không tồn tại!');
             }
            });
          }
          }







    function checkNumber(str) {
        return /[0-9,.\-$]+/.test(str);
    }
    function getValue(str){
       return Number(str.replace(/[^0-9.-]+/g,""));
    }

     function th9(){
        let th6 = document.getElementById('ThthangTruoc6').value;
        let th7 = document.getElementById('ThthangTruoc7').value;
        let t9 =  parseFloat(th6) * parseFloat(th7);


         $("#ThthangTruoc9").val(
                parseFloat(t9).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function dt9(){
        let dt6 = document.getElementById('DuTinh6').value;
        let dt7 = document.getElementById('DuTinh7').value;
        let d9 =  parseFloat(dt6) * parseFloat(dt7);


         $("#DuTinh9").val(
                parseFloat(d9).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function th9_1(){
        let th6_1 = document.getElementById('ThthangTruoc6_1').value;
        let th7_1 = document.getElementById('ThthangTruoc7_1').value;
        let t9_1 =  parseFloat(th6_1) * parseFloat(th7_1);


         $("#ThthangTruoc9_1").val(
                parseFloat(t9_1).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function dt9_1(){
        let dt6_1 = document.getElementById('DuTinh6_1').value;
        let dt7_1 = document.getElementById('DuTinh7_1').value;
        let d9_1 =  parseFloat(dt6_1) * parseFloat(dt7_1);


         $("#DuTinh9_1").val(
               parseFloat(d9_1).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function th10(){
        let th9 = document.getElementById('ThthangTruoc9').value;
        let th8 = document.getElementById('ThthangTruoc8').value;
        let t10 =  parseFloat(th9) * parseFloat(th8);


         $("#ThthangTruoc10").val(
                parseFloat(t10).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

     function dt10(){
        let dt9 = document.getElementById('DuTinh9').value;
        let dt8 = document.getElementById('DuTinh8').value;
        let d10 =  parseFloat(dt9) * parseFloat(dt8);


         $("#DuTinh10").val(
                parseFloat(d10).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function th10_1(){
        let th9_1 = document.getElementById('ThthangTruoc9_1').value;
        let th8_1 = document.getElementById('ThthangTruoc8_1').value;
        let t10_1 =  parseFloat(th9_1) * parseFloat(th8_1);


         $("#ThthangTruoc10_1").val(
                parseFloat(t10_1).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }
     function dt10_1(){
        let dt9_1 = document.getElementById('DuTinh9_1').value;
        let dt8_1 = document.getElementById('DuTinh8_1').value;
        let d10_1 =  parseFloat(dt9_1) * parseFloat(dt8_1);


         $("#DuTinh10_1").val(
                parseFloat(d10_1).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function th17(){
        let th14 = document.getElementById('ThthangTruoc14').value;
        let th15 = document.getElementById('ThthangTruoc15').value;
        let t17 =  parseFloat(th14) * parseFloat(th15);


         $("#ThthangTruoc17").val(
                parseFloat(t17).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function dt17(){
        let dt14 = document.getElementById('DuTinh14').value;
        let dt15 = document.getElementById('DuTinh15').value;
        let d17 =  parseFloat(dt14) * parseFloat(dt15);


         $("#DuTinh17").val(
                parseFloat(d17).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function th17_1(){
        let th14_1 = document.getElementById('ThthangTruoc14_1').value;
        let th15_1 = document.getElementById('ThthangTruoc15_1').value;
        let t17_1 =  parseFloat(th14_1) * parseFloat(th15_1);


         $("#ThthangTruoc17_1").val(
                parseFloat(t17_1).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function dt17_1(){
        let dt14_1 = document.getElementById('DuTinh14_1').value;
        let dt15_1 = document.getElementById('DuTinh15_1').value;
        let d17_1 =  parseFloat(dt14_1) * parseFloat(dt15_1);


         $("#DuTinh17_1").val(
               parseFloat(d17_1).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function th18(){
        let th16 = document.getElementById('ThthangTruoc16').value;
        let th17 = document.getElementById('ThthangTruoc17').value;
        let t18 =  parseFloat(th16) * parseFloat(th17);


         $("#ThthangTruoc18").val(
                parseFloat(t18).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

     function dt18(){
        let dt16 = document.getElementById('DuTinh16').value;
        let dt17 = document.getElementById('DuTinh17').value;
        let d18 =  parseFloat(dt16) * parseFloat(dt17);


         $("#DuTinh18").val(
                parseFloat(d18).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

    function th18_1(){
        let th16_1 = document.getElementById('ThthangTruoc16_1').value;
        let th17_1 = document.getElementById('ThthangTruoc17_1').value;
        let t18_1 =  parseFloat(th16_1) * parseFloat(th17_1);


         $("#ThthangTruoc18_1").val(
                parseFloat(t18_1).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }
     function dt18_1(){
        let dt16_1 = document.getElementById('DuTinh16_1').value;
        let dt17_1 = document.getElementById('DuTinh17_1').value;
        let d18_1 =  parseFloat(dt16_1) * parseFloat(dt17_1);


         $("#DuTinh18_1").val(
                parseFloat(d18_1).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
    }

      </script>
      </form>
        <div id="tableQLTT" class="form-QLTT" style="overflow: scroll;">
        <div class="head-group">
          <div class="title text-center">
            <h5 class="title-first"><b>DANH SÁCH CƠ SỞ</b></h5>
            <label class="title-last"
              ><i>Nhấn vào dòng cơ sở để nhập tin</i></label
            >
          </div>
          <div class="group-radio-btn row">
            <div class="check-form">
              <i class="bi bi-circle-fill" style="color: rgb(0, 160, 255)"></i>
              <label class="text-primary">Đã điều tra</label>
            </div>
            <div class="check-form" style="margin-left: 5px">
              <i class="bi bi-circle-fill" style="color: white"></i>
              <label>Chưa điều tra</label>
            </div>
            <div class="check-form" style="margin-left: 5px">
              <i class="bi bi-circle-fill" style="color: rgb(215, 70, 0)"></i>
              <label class="text">Không điều tra</label>
            </div>
          </div>
        </div>
        <table id="example" class="table table-bordered table-hover" style="max-height: 100%;">
          <thead>
            <tr class="text-center tab-title" style="background-color: #fff3bd;">
              <th class="th1">Điều tra</th>
              <th class="th2">Mã ĐB</th>
              <th class="th3">Cơ sở số</th>
              <th class="th4">Tên cơ sở</th>
            </tr>
          </thead>
          <tbody id="tBody">
            @foreach (ThongTinCaThe m in @getTable())
            {
                @if (count(m.MaCoSo, ViewBag.thang, ViewBag.nam) > 0)
                {
                              <tr style="background-color: rgb(0, 160, 255); cursor:pointer;" onclick="doiPhieu('@m.MaCoSo')">
                                  <td class="text-center">1</td>
                                  <td class="text-center">@m.MaSoThue</td>

                                  <td class="text-center">@m.MaCoSo</td>
                                  <td class="text-center">@m.TenCoSo</td>
                            </tr>
                }
                else
                {
                               <tr style="cursor:pointer;" onclick="doiPhieu('@m.MaCoSo')">
                                  <td class="text-center">1</td>
                                  <td class="text-center">@m.MaSoThue</td>

                                  <td class="text-center">@m.MaCoSo</td>
                                  <td class="text-center">@m.TenCoSo</td>
                               </tr>
                }
            }
          </tbody>
        </table>
      </div>

