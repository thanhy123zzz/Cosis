@model Cosis.Models.PhieuDieuTra
@{
    Layout = null;
    FormCosisContext context = new FormCosisContext();
    string getThangTruoc(string m)
    {
        int i = Int32.Parse(m);
        if (i == 1)
        {
            return "12";
        }
        else
        {
            return toStringMonth(i - 1);
        }
    }
    string getArray()
    {
        if (Model.DanhSachNhanToAnhHuong != null)
        {
            string a = "";
            foreach (DanhSachNhanToAnhHuong l in Model.DanhSachNhanToAnhHuong)
            {
                a = a + "'" + l.MaAh.Trim() + "', ";
            }
            return a;
        }
        else
        {
            return "";
        }

    }

    string toStringMonth(int i)
    {
        if (i.ToString().Length > 1) return i.ToString();
        else return "0" + i;
    }

    List<Master> getMasters()
    {
        return context.Master.ToList();
    }
    string toStringMonthAndYear(int m, int year)
    {
        if (m == 1)
        {
            return 12 + "/" + (year - 1).ToString();
        }
        else
        {
            return toStringMonth(m - 1) + "/" + year;
        }
    }
    string getTinh(string ma)
    {
        return context.TinhTp.Find(ma).Name;
    }
    string getHuyen(string ma)
    {
        return context.QuanHuyen.Find(ma).Name;
    }
    string getXa(string ma)
    {
        return context.PhuongXa.Find(ma).Name;
    }
    List<NganhKinhDoanh> getNganhKinhDoanh(string mast1, string mast2)
    {
        return context.NganhKinhDoanh.Where(x => x.MaSoThue == mast1 && x.MaSoThue2 == mast2).ToList();
    }

    NganhHoatDongKinhDoanh getNganhHoatDongKinhDoanh(string ma)
    {
        return context.NganhHoatDongKinhDoanh.Where(x => x.MaNganh == ma).FirstOrDefault();
    }
    NhanToAnhHuong nhanToAnhHuong(string ma)
    {
        return context.NhanToAnhHuong.Find(ma);
    }
    string format(decimal? a)
    {
        return a?.ToString("N", System.Globalization.CultureInfo.InvariantCulture);

    }
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet"
          href="~/assets/bootstrap-4.5.3-dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/assets/main.css" />
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <!--Form -->
    <div class="container">
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>

      <form id="form" action="/form1_3" method="post" class="form1" enctype="multipart/form-data">
        <div class="form-group text-center">
          <label class="choose-title">
            <b>ĐIỀU TRA HOẠT ĐỘNG THƯƠNG MẠI VÀ DỊCH VỤ </b>
          </label>
        </div>
        <div class="form-group MSTP-info">
          <label class="P-name"><b>Phiếu 1.2/DN-LAD-T</b></label>
          <div class="mstp">
          <label for="">Mã số thuế</label>
                    @if (Model.Master == null)
                    {
                            <div class="row">
                                <input
              type="text"
              id="n0"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              autofocus
              data-next="1"
            />
                                <input
              type="text"
              id="n1"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="2"
            />
                                <input
              type="text"
              id="n2"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="3"
            />
                                <input
              type="text"
              id="n3"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="4"
            />
                                <input
              type="text"
              id="n4"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="5"
            />
                                <input
              type="text"
              id="n5"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="6"
            />
                                <input
              type="text"
              id="n6"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="7"
            />
                                <input
              type="text"
              id="n7"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="8"
            />
                                <input
              type="text"
              id="n8"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="9"
            />
                                <input
              type="text"
              id="n9"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="10"
            />
                            </div>
                            <div class="row">
                                <input
              type="text"
              id="n10"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="11"
            />
                        <input
              type="text"
              id="n11"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="12"
            />
                        <input
              type="text"
              id="n12"
              maxlength="1"
              size="1"
              class="text-center MS"
              autocomplete="off"
              data-next="13"
            />
                      </div>
                          <input type="hidden" id="MST1" value="" name="Master.MaSoThue"/>
                    }
                    else
                    {
                          <div class="row">
                            @for (int i = 0; i < 10; i++)
                            {
                                                <input type="text"
                           id="n0"
                           maxlength="1"
                           size="1"
                           class="text-center MS"
                           autocomplete="off"
                           autofocus
                           data-next="1" 
                           value="@Model.Master.MaSoThue.Substring(i,1)"
                           />
                            }
                            </div>
                            <div class="row">
                            @for (int i = 0; i < 3; i++)
                            {
                                            <input type="text"
                           id="n10"
                           maxlength="1"
                           size="1"
                           class="text-center MS"
                           autocomplete="off"
                           data-next="11" 
                           value="@Model.Master.MaSoThue2.Substring(i,1)"
                           />
                            }
                            </div>
                             <input type="hidden" id="Maphieu" asp-for="@Model.Master.MaPhieu"/>
                             <input type="hidden" id="MST1" value="@Model.Master.MaSoThue@Model.Master.MaSoThue2" name="Master.MaSoThue"/>
                    }

          </div>
        </div>
        <div class="form-group text-center tenphieu">
          <label class="text-center">
            <b>PHIẾU THU THẬP THÔNG TIN ĐỐI VỚI DOANH NGHIỆP/HỢP TÁC XÃ</b>
          </label>
          <label>
            <b>
              <i>
                (Áp dụng đối với doanh nghiệp/chi nhánh doanh nghiệp, hợp tác xã có hoạt động dịch vụ lưu trú, ăn uống, du lịch)
              </i>
            </b>
          </label>
        </div>

        <div class="form-group text-center">
          <div class="row"></div>
          <div>
            <label> <b>Tháng @ViewBag.thang Năm @ViewBag.nam</b> </label>
          </div>
          <div class="row"></div>
        </div>
        <div class="form-group m-title text-center">
          <h5 style="margin-top: .5rem;"><b>A. THÔNG TIN CHUNG</b></h5>
        </div>
        <div id="ThongTinDoanhNghiepGroup" class="form-group">
          <div class="row">
            <label class="lb-info"><b>1. Tên doanh nghiệp/HTX: </b></label>
            <label>@Model.Master.Ten</label>
          </div>
          <div class="adress">
            <label for=""><b>2. Địa chỉ doanh nghiệp: </b></label>
            <div class="adress-detail">
              <div class="row">
                <label class="lb-info">Tỉnh/TP trực thuộc TW: </label>
                <label>@getTinh(Model.Master.MaTinhTp)</label>
              </div>
              <div class="row">
                <label class="lb-info"
                  >Huyện/quận <i>(thị xã, TP thuộc tỉnh)</i>: 
                </label>
                <label>@getHuyen(Model.Master.MaQuanHuyen)</label>
              </div>
              <div class="row">
                <label class="lb-info">Xã/phường/thị trấn:</label>
                <label>@getXa(Model.Master.MaPhuongXa)</label>
              </div>
              <div class="row">
                <label class="lb-info"
                  >Thôn, ấp<i>(số nhà, đường phố)</i>:
                </label>
                <label>@Model.Master.DiaChiCuThe</label> 
              </div>
            </div>
          </div>
          <div class="row">
            <label class="lb-info"><b>3. Số điện thoại: </b></label>
            <label>@Model.Master.Sdt</label>
          </div>
          <div class="row">
            <label class="lb-info"><b>4. Email: </b></label>
            <label>@Model.Master.Email</label>

          </div>
          <div class="loaihinh">
            <label class="lb-info"><b>5. Loại hình kinh tế</b></label>

                    @if (Model.Master.MaLh.Trim() == "01")
                    {
                             <label>Kinh tế nhà nước</label>
                    }
                    else if (Model.Master.MaLh.Trim() == "02")
                    {
                                <label>Kinh tế ngoài nhà nước</label>
                    }
                    else if (Model.Master.MaLh.Trim() == "03")
                    {
                                <label>Kinh tế có vốn đầu tư trực tiếp nước ngoài</label>
                    }
          </div>
          <div class="nganhKD row">
     <label class="nganh-lb" for=""><b>6. Ngành hoạt động kinh doanh</b></label>
    <div class="nganh-ct">
                        @foreach (NganhKinhDoanh nganh in getNganhKinhDoanh(Model.Master.MaSoThue, Model.Master.MaSoThue2))
                        {

                        <div class="row">
                           <div class="MNHD row">
                              <input value="@nganh.MaNganh.Substring(0,1)" type="text"
                         maxlength="1"
                         size="1"
                         class="text-center MN"/>
                                <input value="@nganh.MaNganh.Substring(1,1)"
                      type="text"
                      maxlength="1"
                      size="1"
                      class="text-center MN"
                    />
                                <input value="@nganh.MaNganh.Substring(2,1)"
                      type="text"
                      maxlength="1"
                      size="1"
                      class="text-center MN"
                    />
                                <input value="@nganh.MaNganh.Substring(3,1)"
                      type="text"
                      maxlength="1"
                      size="1"
                      class="text-center MN"
                        />
                                <input value="@nganh.MaNganh.Substring(4,1)"
                      type="text"
                      maxlength="1"
                      size="1"
                      class="text-center MN"
                    />
                          </div>
                              <label for="">Tên ngành HĐKD: @getNganhHoatDongKinhDoanh(nganh.MaNganh).TenNganh</label>

                        </div>
                        }
             </div>
    </div>  
        </div>
        <div class="form-group m-title text-center">
          <h5 style="margin-top: .5rem;"><b>B. KẾT QUẢ HOẠT ĐỘNG KINH DOANH</b></h5>
        </div>
        <table class="table table-striped table-hover table-bordered">
          <thead>
            <tr class="text-center">
              <th><b>Tên chỉ tiêu</b></th>
              <th><b>Đơn vị tính</b></th>
               <th style="width:20%;"><b>Tháng thực hiện @toStringMonthAndYear(Int32.Parse(ViewBag.thang),Int32.Parse(ViewBag.nam))</b></th>
              <th style="width:20%;"><b>Dự tính @toStringMonth(Int32.Parse(ViewBag.thang))/@ViewBag.nam</b></th>
              <th style="width:20%;">
                <b>Cộng dồn từ đầu năm đến cuối tháng @toStringMonth(Int32.Parse(ViewBag.thang))/@ViewBag.nam</b>
              </th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr class="text-center">
              <td>A</td>
              <td>B</td>
              <td>1</td>
              <td>2</td>
              <td>3</td>
            </tr>
            <tr>
              <td>1.Tổng doanh thu
                  <input type="hidden" id="stt0" asp-for="Detail[0].Stt" value="1."/>
                  <input type="hidden" asp-for="Detail[0].TenCt" value="Tổng doanh thu"/>  
              </td>
              <td class="text-center">Triệu đồng
                   <input type="hidden" asp-for="Detail[0].Dvt" value="Triệu đồng"/> 
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly id="ThthangTruoc0" oninput="changeThthangTruoc(0)" value="@format(Model.Detail[0].ThthangTruoc)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly id="DuTinh0" oninput="changeDuTinh(0)" value="@format(Model.Detail[0].DuTinh)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly id="TongCongDon0" value="@format(Model.Detail[0].TongCongDon)" class="infomal" /></td>
            </tr>
            <tr>
              <th attr colspan="5">B1. Dịch vụ lưu trú</th>
            </tr>
            <tr>
              <td>2.Doanh thu thuần
                  <input type="hidden" id="stt2" asp-for="Detail[1].Stt" value="2."/>
                  <input type="hidden" asp-for="Detail[1].TenCt" value="Doanh thu thuần"/>
              </td>
              <td class="text-center">Triệu đồng
                  <input type="hidden" asp-for="Detail[1].Dvt" value="Triệu đồng"/>  
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[1].ThthangTruoc)" id="ThthangTruoc2" oninput="changeThthangTruoc(2)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[1].DuTinh)" id="DuTinh2" oninput="changeDuTinh(2)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[1].TongCongDon)" id="TongCongDon2" oninput="changeCongDon(2)" class="infomal" /></td>
            </tr>
            <tr>
              <td>3.Số lượt khách phục vụ
                 
              </td>
              <td class="text-center">Lượt khách
                   
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[2].ThthangTruoc)" id="ThthangTruoc3" oninput="changeThthangTruoc(3)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[2].DuTinh)" id="DuTinh3" oninput="changeDuTinh(3)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[2].TongCongDon)" id="TongCongDon3" oninput="changeCongDon(3)" class="infomal" /></td>
            </tr>
            <tr>
              <td class="p-1">3.1.Lượt khách ngủ qua đêm
                   
              </td>
              <td class="text-center">Lượt khách
                   
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[3].ThthangTruoc)" id="ThthangTruoc3_1" oninput="changeThthangTruoc('3_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[3].DuTinh)" id="DuTinh3_1" oninput="changeDuTinh('3_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[3].TongCongDon)" id="TongCongDon3_1" oninput="changeCongDon('3_1')" class="infomal" /></td>
            </tr>
            <tr>
              <td class="p-1-1">3.1.1.Trong đó: khách quốc tế
                  
              </td>
              <td class="text-center">Lượt khách
                 
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[4].ThthangTruoc)" id="ThthangTruoc3_1_1" oninput="changeThthangTruoc('3_1_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[4].DuTinh)" id="DuTinh3_1_1" oninput="changeDuTinh('3_1_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[4].TongCongDon)" id="TongCongDon3_1_1" oninput="changeCongDon('3_1_1')" class="infomal" /></td>
            </tr>
            <tr>
              <td class="p-1">3.2.Lượt khách trong ngày
                   
              </td>
              <td class="text-center">Lượt khách
                   
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[5].ThthangTruoc)" id="ThthangTruoc3_2" oninput="changeThthangTruoc('3_2')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[5].DuTinh)" id="DuTinh3_2" oninput="changeDuTinh('3_2')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[5].TongCongDon)" id="TongCongDon3_2" oninput="changeCongDon('3_2')" class="infomal" /></td>
            </tr>
            <tr>
              <td>4.Số ngày phục vụ khách ( chỉ tính khách có ngủ qua đêm)
                  
              </td>
              <td class="text-center">Ngày khách
                  
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[6].ThthangTruoc)" id="ThthangTruoc4" oninput="changeThthangTruoc(4)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[6].DuTinh)" id="DuTinh4" oninput="changeDuTinh(4)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[6].TongCongDon)" id="TongCongDon4" oninput="changeCongDon(4)" class="infomal" /></td>
            </tr>
            <tr>
              <td class="p-1">4.1.Trong đó: khách quốc tế
                  
              <td class="text-center">Ngày khách
                   
              </td>
              <td><input type="text"  pattern="[0-9,.\-$]+" required value="@format(Model.Detail[7].ThthangTruoc)" id="ThthangTruoc4_1" oninput="changeThthangTruoc('4_1')" class="infomal" /></td>
              <td><input type="text"  pattern="[0-9,.\-$]+" required value="@format(Model.Detail[7].DuTinh)" id="DuTinh4_1" oninput="changeDuTinh('4_1')" class="infomal" /></td>
              <td><input type="text"  pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[7].TongCongDon)" id="TongCongDon4_1" oninput="changeCongDon('4_1')" class="infomal" /></td>
            </tr>
            <tr>
              <td>
                5.Giá phòng bình quân 1 lượt khách thuê trong ngày (thuê theo
                 
              </td>
              <td class="text-center">Nghìn đồng
                  
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[8].ThthangTruoc)" id="ThthangTruoc5" oninput="changeThthangTruoc(5)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[8].DuTinh)" id="DuTinh5" oninput="changeDuTinh(5)"  class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[8].TongCongDon)" id="TongCongDon5" oninput="changeCongDon(5)" class="infomal" /></td>
            </tr>
            <tr>
              <th attr colspan="5">B2. Dịch vụ ăn uống</th>
            </tr>
            <tr>
              <td>6.Doanh thu thuần
                  
              </td>

              <td class="text-center">Triệu đồng
                   
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[9].ThthangTruoc)" id="ThthangTruoc6" oninput="changeThthangTruoc(6)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[9].DuTinh)" id="DuTinh6" oninput="changeDuTinh(6)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[9].TongCongDon)" id="TongCongDon6" oninput="changeCongDon(6)" class="infomal" /></td>
            </tr>
            <tr>
              <td class="p-1">6.1.Trong đó: doanh thu thuần hàng chuyên bán
                
              </td>
              <td class="text-center">Triệu đồng
                  
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[10].ThthangTruoc)" id="ThthangTruoc6_1" oninput="changeThthangTruoc('6_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[10].DuTinh)" id="DuTinh6_1" oninput="changeDuTinh('6_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[10].TongCongDon)" id="TongCongDon6_1" oninput="changeCongDon('6_1')" class="infomal" /></td>
            </tr>
            <tr>
              <td>
                7.Trị giá vốn của hàng chuyên bán (tương ứng với doanh thu hàng
                tháng)
                 
              </td>
              <td class="text-center">Triệu đồng
                   
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[11].ThthangTruoc)" id="ThthangTruoc7" oninput="changeThthangTruoc(7)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[11].DuTinh)" id="DuTinh7" oninput="changeDuTinh(7)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[11].TongCongDon)" id="TongCongDon7" oninput="changeCongDon(7)" class="infomal" /></td>
            </tr>
            <tr>
              <th attr colspan="5">
                B3. Dịch vụ lữ hành và hoạt động hỗ trợ du lịch
              </th>
            </tr>
            <tr>
              <td>8.Doanh thu thuần
                  
              </td>
              <td class="text-center">Triệu đồng
                  
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[12].ThthangTruoc)" id="ThthangTruoc8" oninput="changeThthangTruoc(8)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[12].DuTinh)" id="DuTinh8" oninput="changeDuTinh(8)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[12].TongCongDon)" id="TongCongDon8" oninput="changeCongDon(8)" class="infomal" /></td>
            </tr>
            <tr>
              <td class="p-1">
                8.1.Trong đó: doanh thu thuần điều hành (tuor) du lịch
                  
              </td>
              <td class="text-center">Triệu đồng
                   
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[13].ThthangTruoc)" id="ThthangTruoc8_1" oninput="changeThthangTruoc('8_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[13].DuTinh)" id="DuTinh8_1" oninput="changeDuTinh('8_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[13].TongCongDon)" id="TongCongDon8_1" oninput="changeCongDon('8_1')" class="infomal" /></td>
            </tr>
            <tr>
              <td>9.Lượt khách du lịch theo tuor
                  
              </td>
              <td class="text-center">Lượt khách
                  
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[14].ThthangTruoc)" id="ThthangTruoc9" oninput="changeThthangTruoc(9)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[14].DuTinh)" id="DuTinh9" oninput="changeDuTinh(9)" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[14].TongCongDon)" id="TongCongDon9" oninput="changeCongDon(9)" class="infomal" /></td>
            </tr>
            <tr>
              <th attr colspan="5">Chia ra:</th>
            </tr>
            <tr>
              <td class="p-1">9.1.Lượt khách quốc tế
                 
              </td>
              <td class="text-center">Lượt khách
                  
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[15].ThthangTruoc)" id="ThthangTruoc9_1" oninput="changeThthangTruoc('9_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[15].DuTinh)" id="DuTinh9_1" oninput="changeDuTinh('9_1')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[15].TongCongDon)" id="TongCongDon9_1" oninput="changeCongDon('9_1')" class="infomal" /></td>
            </tr>
            <tr>
              <td class="p-1">9.2.Lượt khách Việt Nam đi trong nước
                  
              </td>
              <td class="text-center">Lượt khách
                 
              </td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[16].ThthangTruoc)" id="ThthangTruoc9_2" oninput="changeThthangTruoc('9_2')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required value="@format(Model.Detail[16].DuTinh)" id="DuTinh9_2" oninput="changeDuTinh('9_2')" class="infomal" /></td>
              <td><input type="text" pattern="[0-9,.\-$]+" required readonly value="@format(Model.Detail[16].TongCongDon)" id="TongCongDon9_2" oninput="changeCongDon('9_2')" class="infomal" /></td>
            </tr>
          </tbody>
        </table>
        <div class="form-group m-title text-center">
          <h5 style="margin-top: .5rem;"><b>C. CÁC YẾU TỔ ẢNH HƯỞNG ĐẾN HOẠT ĐỘNG KINH DOANH</b></h5>
        </div>
        <div class="form-group">
            <div class="row">
          <label
            ><b>Yếu tố nào sau đây ảnh hưởng đến hoạt động kinh doanh của đơn vị
            trong tháng @ViewBag.thang/@ViewBag.nam </b></label
          >
          </div>
          <div class="YTAH">
                    <div class="YTAH-tt">
                        @for (int i = 0; i < Model.DanhSachNhanToAnhHuong.Count; i++)
                        {
                                   <label for="">@(i + 1). @nhanToAnhHuong(@Model.DanhSachNhanToAnhHuong[i].MaAh).NoiDungAh</label>
                        }
                    </div>
                </div>
                @if (Model.NhanToThu9 != null)
                {
                            <div class="YTAH9" style="margin-left:20px;">
                                <label>Yếu tố khác: @Model.NhanToThu9.NoiDung</label>
                            </div>
                }
        </div>
        <div class="uname-info">
          <div class="row">
            <label class="uname-lb"><b>Họ tên người trả lời:</b></label>
            <label>@Model.Master.TenNguoiTraLoi</label>
          </div>
          <div class="row">
            <label class="uname-lb"><b>Số điện thoại:</b></label>
            <label>@Model.Master.SdtnguoiTraLoi</label>
          </div>
        </div>
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script type="text/javascript">
    var citis = document.getElementById("city");
var districts = document.getElementById("district");
var wards = document.getElementById("ward");
var Parameter = {
  url: "https://localhost:44358/assets/DiaChi.json", 
  method: "GET", 
  responseType: "application/json", 
};
var promise = axios(Parameter);
promise.then(function (result) {
  renderCity(result.data);
});

function renderCity(data) {
  for (const x of data) {
    citis.options[citis.options.length] = new Option(x.Name, x.Id);
  }
  citis.onchange = function () {
    district.length = 1;
    ward.length = 1;
    if(this.value != ""){
      const result = data.filter(n => n.Id === this.value);

      for (const k of result[0].Districts) {
        district.options[district.options.length] = new Option(k.Name, k.Id);
      }
    }
  };
  district.onchange = function () {
    ward.length = 1;
    const dataCity = data.filter((n) => n.Id === citis.value);
    if (this.value != "") {
      const dataWards = dataCity[0].Districts.filter(n => n.Id === this.value)[0].Wards;

      for (const w of dataWards) {
        wards.options[wards.options.length] = new Option(w.Name, w.Id);
      }
    }
  };
}

$('.infomal').on('blur', format);
function format(){
    if(checkNumber(this.value)){
        const value = this.value.replace(/,/g, '');
        this.value = parseFloat(value).toLocaleString('en-US', {
        style: 'decimal',
            maximumFractionDigits: 2,
            minimumFractionDigits: 2
            })
    }
}

    function changeThthangTruoc(tt){

      /*  $('#ThthangTruoc'+tt).val($('#ThthangTruoc'+tt).val().replace(/\D/g, ''));*/
      /* if(tt==4){
           $('#ThthangTruoc4_1').attr({
            "max" : $('#ThthangTruoc'+tt).val()
        });
       }else if(tt==3){
           $('#ThthangTruoc3_1').attr({
            "max" : $('#ThthangTruoc'+tt).val()
        });
       }else if(tt==9){
           $('#ThthangTruoc9_1').attr({
            "max" : $('#ThthangTruoc'+tt).val()
        });
       }
       else if(tt==10){
           $('#ThthangTruoc10_1').attr({
            "max" : $('#ThthangTruoc'+tt).val()
        });
       }
       */
        var value = getValue($('#ThthangTruoc'+tt).val());

        if(checkNumber(value)){
            var stt = $('#stt'+tt).val();        
            var mst = $('#MST1').val();
            var duTinh = $('#DuTinh'+tt).val();
            var thangDuTinh = $('#phieuThang').val();
            var nam = $('#phieuNam').val()
            $.ajax({
                type: 'POST',
                url: '/get-tong',
                data: "mast=" + mst + "&stt="+stt+"&thangTrc="+value+"&duTinh="+duTinh+"&thangDuTinh="+thangDuTinh+"&nam="+nam,
                success: function (result) {
                    $('#TongCongDon'+tt).val(
                        parseFloat(result).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
                    );
                    changeCongDon(result,tt);
                },
               error: function (result) {
               alert('Mã số thuế không tồn tại!');
             }
            });
          }
        if(tt==2||tt==8||tt==14||tt==15){
            var tong = 0;
            var value2 = getValue($('#ThthangTruoc'+2).val());
            if(checkNumber(value2)){
                tong = tong + value2;
            }
            var value8 = getValue($('#ThthangTruoc'+8).val());
            if(checkNumber(value8)){
                tong = tong + value8;
            }
            var value14 = getValue($('#ThthangTruoc'+14).val());
            if(checkNumber(value14)){
                tong = tong + value14;
            }
            var value15 = getValue($('#ThthangTruoc'+15).val());
            if(checkNumber(value15)){
                tong = tong + value15;
            }
            $("#ThthangTruoc0").val(
            parseFloat(tong).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
        }
    }
    function changeDuTinh(tt){
       /* $('#DuTinh'+tt).val($('#DuTinh'+tt).val().replace(/\D/g, ''));*/

        /*if(tt==4){
           $('#DuTinh4_1').attr({
            "max" : $('#DuTinh'+tt).val()
        });
       }else if(tt==3){
           $('#DuTinh3_1').attr({
            "max" : $('#DuTinh'+tt).val()
        });
       }else if(tt==9){
           $('#DuTinh9_1').attr({
            "max" : $('#DuTinh'+tt).val()
        });
       }
       else if(tt==10){
           $('#DuTinh10_1').attr({
            "max" : $('#DuTinh'+tt).val()
        });
       }*/

        var value = parseFloat($('#DuTinh'+tt).val());

        if(checkNumber(value)){
            var stt = $('#stt'+tt).val();        
            var mst = $('#MST1').val();
            var duTinh = $('#ThthangTruoc'+tt).val();
            var thangDuTinh = $('#phieuThang').val();
            var nam = $('#phieuNam').val();
            $.ajax({
                type: 'POST',
                url: '/get-tong',
                data: "mast=" + mst + "&stt="+stt+"&thangTrc="+value+"&duTinh="+duTinh+"&thangDuTinh="+thangDuTinh+"&nam="+nam,
                success: function (result) {
                    $('#TongCongDon'+tt).val(
                        parseFloat(result).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
                    );
                    changeCongDon(result,tt);
                },
               error: function (result) {
               alert('Mã số thuế không tồn tại!');
             }
            });
          }
          if(tt==2||tt==8||tt==14||tt==15){
            var tong = 0;
            var value2 = getValue($('#DuTinh'+2).val());
            if(checkNumber(value2)){
                tong = tong + value2;
            }
            var value8 = getValue($('#DuTinh'+8).val());
            if(checkNumber(value8)){
                tong = tong + value8;
            }
            var value14 = getValue($('#DuTinh'+14).val());
            if(checkNumber(value14)){
                tong = tong + value14;
            }
            var value15 = getValue($('#DuTinh'+15).val());
            if(checkNumber(value15)){
                tong = tong + value15;
            }
            $("#DuTinh0").val(
            parseFloat(tong).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
        }
        /*var tong = 0;
        for(var i=1;i<=15;i++){
            var value = parseFloat($('#DuTinh'+i).val()); 
            if((!isNaN(value) && $('#DuTinh'+i).val() === '' + value)){
            tong = tong + value;
          }
       }
       $("#TongDuTinh").val(tong);*/
    }

    function changeCongDon(result,tt){

        if(tt==2||tt==8||tt==14||tt==15){
            var tong = 0;
            if(checkNumber($('#TongCongDon2').val())){
                tong = tong + getValue($('#TongCongDon2').val());
            }
            if(checkNumber($('#TongCongDon8').val())){
                tong = tong + getValue($('#TongCongDon8').val());
            }
            if(checkNumber($('#TongCongDon14').val())){
                tong = tong + getValue($('#TongCongDon14').val());
            }
            if(checkNumber($('#TongCongDon').val())){
                tong = tong + getValue($('#TongCongDon15').val());
            }
            $("#TongCongDon0").val(
                parseFloat(tong).toLocaleString('en-US', {
                        style: 'decimal',
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                      })
            );
        }
    }
        $(document).ready(function(){
            var a = [@Html.Raw(getArray())];
            a.forEach(myFunction);

    })
    $(window).scroll(function(){

    })
    function myFunction(item, index) {
        for(var i =0 ;i<=7;i++){
                if($('#DanhSachNhanToAnhHuong_'+i).val()== item){
                    $('#DanhSachNhanToAnhHuong_'+i).prop('checked', true);
                }
        }
    }
    function checkNumber(str) {
        return /[0-9,.\-$]+/.test(str);
    }
    function getValue(str){
       return Number(str.replace(/[^0-9.-]+/g,""));
    }

        function doiPhieu(mst1,mst2){
        var thang = $('#phieuThang').val();
        var nam = $('#phieuNam').val();
        var s = "@Html.Raw(ViewBag.LoaiPhieu)";
        console.log(s);
          $.ajax({
                    type: 'POST',
                    url: '/get-tableTTDN',
                    data: "thang=" + thang + "&nam="+nam + "&loaiPhieu=" +s,
                    success: function (result) {
                        $('#tBody').replaceWith(result);
                    },
                    error: function (result) {
                        alert('Mã số thuế không tồn tại!');
             }
            });
          $.ajax({
                    type: 'POST',
                    url: '/changePhieu1_3',
                    data: "thang=" + thang + "&nam="+nam + "&mst1="+mst1+"&mst2="+mst2,
                    success: function (result) {
                        $('#form').replaceWith(result);
                                let kq = "@User.IsInRole("001")"
                            if(kq=="True"){
                                $('#bodyDiv').addClass("col-lg-12");
                                $('#form').addClass("form");
                                $('#tableQLTT').css("display","block");
                                $('.MS').prop('readonly', false);
                            }else{
                                $('#tableQLTT').css("display","none");
                                $('#form').addClass("form1");
                                $('.MS').prop('readonly', true);
                            }

                    },
                    error: function (result) {
                        alert('Mã số thuế không tồn tại!');
             }
            });
    }
        $(".MS").keyup(function() {

        var valueArr = [];
                document.querySelectorAll('.MS').forEach(function(el){
                valueArr.push(el.value);
            });
        strMS = "";
        valueArr.forEach(AddMS)
        $('#MST1').val(strMS);
        if(strMS.length==13){
                $.ajax({
                    type: 'POST',
                    url: '/loadMaster',
                    data: "ms=" + strMS,
                    success: function (result) {
                        $('#ThongTinDoanhNghiepGroup').replaceWith(result);
                    },
                    error: function (result) {
                        alert('Mã số thuế không tồn tại!');
                    }
            });
            doiPhieu(strMS.substring(0, 10),strMS.substring(10, 13));
        }
    });
</script>
      </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    </body>
</html>

